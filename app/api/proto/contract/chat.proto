syntax = "proto3";

package chat;

option go_package = "github.com/charmingruby/clowork/api/proto/pb";

import "google/protobuf/timestamp.proto";

service ChatStream {
    rpc Stream(ClientEvent) returns (ServerEvent);
};

service ChatAPI {
    rpc CreateRoom(CreateRoomRequest) returns (CreateRoomReply);
    rpc ListRooms(ListRoomsRequest) returns (ListRoomsReply);
    rpc ListRoomMessages(ListRoomMessagesRequest) returns (ListRoomMessagesReply);
    rpc ListRoomMembers(ListRoomMembersRequest) returns (ListRoomMembersReply);
};

message ClientEvent {};

message ServerEvent {};

message ListRoomsRequest {
    int64 page = 1; 
};

message ListRoomsReply {
    repeated Room rooms = 1;
    int64 results = 2;
};

message ListRoomMessagesRequest {
    int64 page = 1; 
    string room_id = 2;
};

message ListRoomMessagesReply {
    repeated Message messages = 1;
    int64 results = 2;
};

message ListRoomMembersRequest {};

message ListRoomMembersReply {};

message CreateRoomRequest {
    string name = 1;
    string topic = 2; 
};

message CreateRoomReply {
    string room_id = 1;
};

message Room {
    string id = 1;
    string name = 2;
    string topic = 3;
    google.protobuf.Timestamp created_at = 4;
};

message Message {
    string id = 1;
    string content = 2;
    string room_id = 3;
    string sender_id = 4;
    google.protobuf.Timestamp created_at = 5;
};